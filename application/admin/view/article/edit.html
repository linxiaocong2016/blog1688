<style>
    .cl .formControls .file{
        position:relative;width:200px;height:175px;border:1px dashed #ccc;overflow:hidden
    }
    .cl .formControls .file input[type=file]{
        position:absolute;left:0;top:0;width:100%;height:100%;opacity:0;cursor:pointer
    }
    .cl .formControls .file .add{
        text-align:center;line-height:175px;font-size:40px;color:#ccc
    }
    .cl .formControls .file .pic{display:none}
    .cl .formCenter .file .pic img{width:100%;height:100%}
</style>
<article class="page-container">
	<form class="form form-horizontal" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>文章标题：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$articleInfo.title}" placeholder="" id="articletitle" name="articletitle">
			</div>
		</div>
		<!--<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">简略标题：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="articletitle2" name="articletitle2">
			</div>
		</div>-->
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>分类栏目：</label>
			<div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select name="articlecolumn" class="select" id="articlecatid">
                    {volist name="articleCate" id="vo" key="k"}
                    {if $vo['level'] == 0}
                    <option value="{$vo.id}" {if $vo.id == $articleInfo.cat_id} selected {/if}>{$vo.name}</option>
                    {else}
                    <option value="{$vo.id}" {if $vo.id == $articleInfo.cat_id} selected {/if}>├{$vo.name}</option>
                    {/if}
                    {/volist}
				</select>
				</span> </div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">排序值：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$articleInfo.sort}" placeholder="" id="articlesort" name="articlesort">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">关键词：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$articleInfo.keyword}" placeholder="" id="keywords" name="keywords">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">文章摘要：</label>
			<div class="formControls col-xs-8 col-sm-9">
                            <textarea name="abstract" id="abstract" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入10个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！" onKeyUp="$.Huitextarealength(this,200)">{$articleInfo.desc}</textarea>
				<p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">文章作者：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$articleInfo.author}" placeholder="" id="author" name="author">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">文章来源：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="{$articleInfo.source}" placeholder="" id="sources" name="sources">
			</div>
		</div>
		<!--<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">允许评论：</label>
			<div class="formControls col-xs-8 col-sm-9 skin-minimal">
				<div class="check-box">
					<input type="checkbox" id="allowcomments" name="allowcomments" value="1">
					<label for="checkbox-pinglun">&nbsp;</label>
				</div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">评论开始日期：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" onfocus="WdatePicker()" id="commentdatemin" name="commentdatemin" class="input-text Wdate">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">评论结束日期：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" onfocus="WdatePicker()" id="commentdatemax" name="commentdatemax" class="input-text Wdate">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">使用独立模版：</label>
			<div class="formControls col-xs-8 col-sm-9 skin-minimal">
				<div class="check-box">
					<input type="checkbox" id="checkbox-moban">
					<label for="checkbox-moban">&nbsp;</label>
				</div>
				<button onClick="mobanxuanze()" class="btn btn-default radius ml-10">选择模版</button>
			</div>
		</div>-->
        <div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">缩略图：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
                    <div class="file uploadImage">
                        {if $articleInfo['image'] != ''}
                        <div class="add" style="display: none;">+</div>
                        <div class="pic" style="display: block;"><img src="{$domain.$articleInfo.image}" alt="图片" data-imgurl="{$articleInfo.image}"></div>
                        {else}
                        <div class="add">+</div>
                        <div class="pic"><img src=""  alt="图片"></div>
                        {/if}
                        <input type="file" id="file" accept="image/gif,image/jpeg,image/jpg,image/png,image/svg">
                    </div>
                    <p>尺寸400*350，大小1M以内，格式JPG、PNG</p>
            </div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">文章内容：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor" type="text/plain" style="width:100%;height:400px;"></script> 
			</div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button onClick="article_save_submit();" class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 保存并提交审核</button>
				<!--<button onClick="article_save();" class="btn btn-secondary radius" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存草稿</button>-->
				<button onClick="removeIframe();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</article>

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__STATIC__/admin/common/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__STATIC__/admin/common/lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/common/lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/common/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="__STATIC__/admin/common/lib/webuploader/0.1.5/webuploader.min.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/common/lib/ueditor/1.4.3/ueditor.config.js"></script> 
<script type="text/javascript" src="__STATIC__/admin/common/lib/ueditor/1.4.3/ueditor.all.min.js"> </script> 
<script type="text/javascript" src="__STATIC__/admin/common/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
$(function(){
	$('.skin-minimal input').iCheck({
		checkboxClass: 'icheckbox-blue',
		radioClass: 'iradio-blue',
		increaseArea: '20%'
	});
	
	//表单验证
	$("#form-article-add").validate({
		rules:{
			articletitle:{
				required:true,
			},
//			articletitle2:{
//				required:true,
//			},
			articlecatid:{
				required:true,
			},
			articlesort:{
				required:true,
			},
			keywords:{
				required:true,
			},
			abstract:{
				required:true,
			},
			author:{
				required:true,
			},
			sources:{
				required:true,
			},
//			allowcomments:{
//				required:true,
//			},
//			commentdatemin:{
//				required:true,
//			},
//			commentdatemax:{
//				required:true,
//			},

		},
		onkeyup:false,
		focusCleanup:true,
		success:"valid",
		submitHandler:function(form){
			//$(form).ajaxSubmit();
//			var index = parent.layer.getFrameIndex(window.name);
//			//parent.$('.btn-refresh').click();
//			parent.layer.close(index);
		}
	});
        
    $('.uploadImage #file').on('change',function(){
        getImgUrl({
            _this:$(this)
        })
    });

    
});
var ue = UE.getEditor('editor');
ue.ready(function() {
    //异步回调
    UE.getEditor('editor').execCommand('insertHtml', '{$articleInfo.content}');
});
function article_save_submit()
{
    getArticleForm(function(data){
        data.id = '{$articleInfo.id}';
        $.ajax({
            type:'POST',
            url:'/admin/article/edit',
            data:data,
            success:function(res){
                if(res.code==1){
                    alert('更新成功,立即返回列表页~~~')
                    window.location.href = '/admin/article/index'
                }else{
                    alert(res.msg)
                }
            }
        })

    })
}

//添加渠道或者编辑渠道表单获取
function getArticleForm(callback){
    var callback = callback || function(){}

    var articletitle = $("#articletitle").val()
    var articletitle2 = $('#articletitle2').val()
    var articlecatid = $("#articlecatid").val()
    var articlesort = $("#articlesort").val()
    var keywords = $("#keywords").val()
    var abstract = $("#abstract").val()
    var author = $("#author").val()
    var sources = $("#sources").val()
    var image = ''
    if($('.uploadImage img').attr('data-imgurl')){
        image = $('.uploadImage img').attr('data-imgurl')
    }
//    var allowcomments = $("input:checkbox[name='allowcomments']:checked").val()
//    var commentdatemin = $("#commentdatemin").val()
//    var commentdatemax = $("#commentdatemax").val()
    var content = ue.getContent(); //获取带标签的文本
//    var editor = ue.getContentTxt();//获取去除标签的文本

    var data = {
        articletitle:articletitle,
        articletitle2:articletitle2,  
        articlecatid:articlecatid,  
        articlesort:articlesort,
        keywords:keywords,
        abstract:abstract,
        author:author,
        sources:sources,
//        allowcomments:allowcomments,
//        commentdatemin:commentdatemin,
//        commentdatemax:commentdatemax,
        image:image,
        content:content
    }
    callback(data)
}
</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>